let t=null;class e{constructor(e){if(t)return t;this.config={bubbleIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-icon"><path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"/></svg>',bubbleColor:"#4f46e5",iconColor:"#ffffff",pulseColor:"#34d399",tooltipText:"Chat with us!",tooltipColor:"#333333",tooltipBgColor:"#ffffff",closeClickOutside:!0,bubbleSize:56,bubblePosition:"bottom-right",iframeWidth:340,iframeHeight:500,iframeBorderRadius:8,autoOpen:0,shadow:"0 25px 50px -12px rgba(0,0,0,0.4)",bubbleShadow:"0 10px 40px rgba(0,0,0,0.2)",...e},this.bubble=null,this.iframe=null,this.autoOpenTimeout=null,this.isOpen=!1,window.addEventListener("message",t=>{"https://app.ecodrix.com"!==t.origin&&"http://localhost:3000"!==t.origin||"CHAT_WIDGET_CLOSE"===t.data?.type&&this.hideIframe()}),window.addEventListener("resize",()=>this.updateDimensions()),window.addEventListener("orientationchange",()=>this.updateDimensions())}init(){this.updateDimensions(),this.addStyles(),this.createBubble(),this.preloadIframe(),this.config.autoOpen>0&&(this.autoOpenTimeout=setTimeout(()=>this.showIframe(),1e3*this.config.autoOpen))}updateDimensions(){if(!this.iframe)return;const t=window.innerWidth,e=window.innerHeight;let i=this.config.iframeWidth,n=this.config.iframeHeight;t<=768&&(i=Math.min(360,.9*i),n=Math.min(540,1*n)),t<=480&&(i=t-80,n=.7*e),this.iframe.style.width=`${i}px`,this.iframe.style.height=`${n}px`}addStyles(){if(document.getElementById("ecodrix-widget-styles"))return;const t=document.createElement("style");t.id="ecodrix-widget-styles",t.textContent="\n      @keyframes ecodrix-bubble-float {\n        0% { transform: translateY(0px) scale(1); }\n        50% { transform: translateY(-5px) scale(1.02); }\n        100% { transform: translateY(0px) scale(1); }\n      }\n      @keyframes ecodrix-bubble-pulse {\n        0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4); }\n        70% { box-shadow: 0 0 0 15px rgba(79, 70, 229, 0); }\n        100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }\n      }\n\n    ",document.head.appendChild(t)}createBubble(){this.bubbleContainer=document.createElement("div");const t=this.config.bubblePosition.split("-");this.bubbleContainer.style.cssText=`\n    position: fixed;\n    ${t[0]}: 24px;\n    ${t[1]}: 16px;\n    width: ${this.config.bubbleSize}px;\n    height: ${this.config.bubbleSize}px;\n    z-index: 100000;\n    pointer-events: auto;\n  `,this.bubble=document.createElement("div"),this.bubble.style.cssText=`\n    width: ${this.config.bubbleSize}px;\n    height: ${this.config.bubbleSize}px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, ${this.config.bubbleColor}, ${this.shadeColor(this.config.bubbleColor,-20)});\n    color: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    overflow: visible;\n    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);\n    box-shadow: ${this.config.bubbleShadow};\n  `;const e=document.createElement("div");e.style.cssText="\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.3s ease;\n  ",e.innerHTML=this.config.bubbleIcon,this.bubble.appendChild(e),this.iconContainer=e,this.bubbleContainer.appendChild(this.bubble),document.body.appendChild(this.bubbleContainer),this.tooltip=document.createElement("div"),this.tooltip.innerText=this.config.tooltipText,this.tooltip.style.cssText=`\n      position: absolute;\n      top: 50%;\n      right: calc(100% + 8px);\n      transform: translateY(-50%);\n      background-color: ${this.config.tooltipBgColor};\n      color: ${this.config.tooltipColor};\n      padding: 6px 12px;\n      border-radius: 6px;\n      font-size: 12px;\n      font-weight: 500;\n      white-space: nowrap;\n      pointer-events: none;\n      opacity: 0;\n      transition: opacity 0.3s ease, transform 0.3s ease;\n      text-align: center;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n      z-index: 100001;\n    `;const i=document.createElement("div");i.style.cssText=`\n      position: absolute;\n      width: 0;\n      height: 0;\n      border-top: 5px solid transparent;\n      border-bottom: 5px solid transparent;\n      border-left: 5px solid ${this.config.tooltipBgColor};\n      right: -5px;\n      top: 50%;\n      transform: translateY(-50%);\n    `,this.tooltip.appendChild(i),this.bubbleContainer.appendChild(this.tooltip),this.bubble.addEventListener("mouseenter",()=>{this.isOpen||(this.bubble.style.transform="scale(1.1)",this.iconContainer.style.transform="scale(1.1)",this.tooltip.style.opacity="1",this.tooltip.style.transform="translateY(-50%) translateX(-5px)")}),this.bubble.addEventListener("mouseleave",()=>{this.isOpen||(this.bubble.style.transform="scale(1)",this.iconContainer.style.transform="scale(1)",this.tooltip.style.opacity="0",this.tooltip.style.transform="translateY(-50%) translateX(0)")}),this.bubble.addEventListener("click",()=>this.toggleIframe())}preloadIframe(){this.iframe=document.createElement("iframe"),this.iframe.src=this.config.botUrl,this.iframe.allow="microphone",this.iframe.style.cssText=`\n      position: fixed;\n      bottom: ${this.config.bubbleSize+24}px;\n      right: 16px;\n      width: ${this.config.iframeWidth}px;\n      height: ${this.config.iframeHeight}px;\n      border: none;\n      border-radius: ${this.config.iframeBorderRadius}px;\n      box-shadow: ${this.config.shadow};\n      z-index: 99999;\n      opacity: 0;\n      transform: scale(0.8) translateY(20px);\n      transform-origin: bottom right;\n      pointer-events: none;\n      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n      background: white;\n    `,document.body.appendChild(this.iframe)}toggleIframe(){this.isOpen?this.hideIframe():this.showIframe()}showIframe(){this.iframe&&(this.isOpen=!0,this.tooltip.style.opacity="0",this.bubble.style.transform="scale(1)",this.iframe.style.opacity="1",this.iframe.style.transform="scale(1) translateY(0)",this.iframe.style.pointerEvents="auto")}hideIframe(){this.iframe&&(this.isOpen=!1,this.iframe.style.opacity="0",this.iframe.style.transform="scale(0.8) translateY(20px)",this.iframe.style.pointerEvents="none")}shadeColor(t,e){let i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),s=parseInt(t.substring(5,7),16);i=Math.min(255,Math.round(i*(100+e)/100)),n=Math.min(255,Math.round(n*(100+e)/100)),s=Math.min(255,Math.round(s*(100+e)/100));return`#${i.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}destroy(){this.iframe&&this.iframe.remove(),this.bubble&&this.bubble.remove(),this.autoOpenTimeout&&clearTimeout(this.autoOpenTimeout);const e=document.getElementById("ecodrix-widget-styles");e&&e.remove(),t=null}}"undefined"!=typeof window&&(window.ECODrIx={init:i=>(t=new e(i),t.init(),t),destroy:()=>t?.destroy(),show:()=>t?.showIframe(),hide:()=>t?.hideIframe()});export{e as ECODrIx};
